import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';


# 私有链接 Private Link

Relyt 支持私有链接（Private Link）功能为用户提供私有网络访问服务，在简化了网络架构的同时，保证了用户的数据安全。

---

## 概述

私有链接功能允许用户在自己部署在其他云上 VPC（虚拟私有云，Virtual Private Cloud）和 Relyt 上指定的数据库资源之间建立私有链接，从而保证数据流量不会暴露到公网。

相较于公网访问，私有链接具有如下主要优势：

- 私有链接至 Relyt 上的数据库资源，数据访问更安全

- 无需任何路由配置，即可建立安全的链接，数据访问更简单

- 支持主流服务商提供的 VPC 服务，且不受地域限制，全球覆盖


如需在 Relyt 上创建私有链接，你必须在对应的 VPC 对应的集群中创建一个端点。然后在 Relyt 控制台上注册对应云供应商的 VPC、子网等相关信息。具体操作步骤，因链接的公有云而异。

---

## 前提条件

- 已获取 Relyt 账号及密码。

- 已获取对应公有云的账号及密码。

- Relyt 下存在可用的数仓服务单元。


---


## 创建私有链接

<Tabs>
  <TabItem value="阿里云" label="阿里云" default>

    ### 步骤一：进入创建私有链接页面
  
    1. 登录 Relyt 控制台，在上方导航栏中，选择 **数仓服务单元**。
  
    2. 点击目标数仓服务单元卡片右上角 **...**，选择 **连接信息**。
  
    3. 在数仓服务单元的 **连接信息** 页面，点击 **+ 私有链接** 按钮。
  
    4. 在弹出的 **创建私有链接** 对话框中，等待系统准备完成后，输入要连接的 VPC 对应的阿里云账号 ID，点击 **继续**。

    5. 选择 **创建新的 VPC 端点**。

        如你的阿里云账号下存在可用的端点，在 **VPC 端点** 字段中，输入用于创建私有连接的 VPC 端点 ID，点击 **创建**。然后跳转至 [步骤五：为端点添加可用区和网卡](#步骤五为端点添加可用区和网卡).

     

    ### 步骤二：获取 VPC ID 和安全组 ID 

    端点创建命令需要阿里云的 VPC ID 和安全组 ID 信息。
    
    **获取 VPC ID：**

    1. 登录 [阿里云专有网络管理控制台](https://vpcnext.console.aliyun.com/vpc/cn-qingdao/vpcs)。

    2. 在顶部状态栏处，选择 VPC 所在的地域。

        此处的地域必须和 Relyt 控制台上 **云提供商和地域** 字段展示的地域一致。

    3. 在 **专有网络** 页面，找到目标 VPC，获取 VPC ID 即可。

    <br/>

    **获取安全组 ID：**

    1. 使用上一操作中的阿里云账号登录 [阿里云云服务器 ECS 控制台](https://ecs.console.aliyun.com/?spm=a2c4g.11186623.0.0.30df277083k8hX)。

    2. 在左侧导航栏，选择 **网络与安全** > **安全组**。

    3. 在右侧的安全组列表中，找到目标安全组，获取安全组 ID 即可。

        :::info 说明
        如无合适的安全组，请参考阿里云官方文档的 [创建安全组](https://help.aliyun.com/zh/ecs/user-guide/create-a-security-group-1?spm=a2c4g.11186623.0.0.15d95665YecpdS) 进行创建。
        :::

    <br/>

    返回到 Relyt 的 **创建 VPC 端点** 页面，将获取到的 VPC ID 和安全组 ID 输入到对应字段中，等待端点创建命令自动生成。

     


    ### 步骤三：执行端点创建命令获取端点 ID

    1. 复制生成的端点创建命令。

    2. 登录阿里云 [Cloud Shell](https://shell.aliyun.com/)。

    3. 粘贴命令到 Cloud Shell 中，并执行。

    3. 在命令返回结果中，找到 **EndpointId** 字段，复制该字段值。

     

    ### 步骤四：授权端点链接

    1. 打开 Relyt 页面，点击 **上一步** 返回至 **创建私有链接** 页面。
    
    2. 将步骤三种获取到的端点 ID 填入 **创建私有链接** 页面的 **VPC 端点** 字段中。

    3. 点击 **创建**。

     

    ### 步骤五：为端点添加可用区和网卡

    为阿里云 VPC 创建私有链接时，必须为对应的端点配置可用区和网卡。

    1. 登录 [阿里云云服务器 ECS 控制台](https://ecs.console.aliyun.com/?spm=a2c4g.11186623.0.0.30df277083k8hX)。

    2. 在左侧导航栏中，选择 **终端节点**。

    3. 点击对应的端点 ID，进入端点详情页。选择 **可用区与网卡**。

    4. 按提示完成相应配置。

     

    ### 步骤六：获取端点的域名和可用区域名

    1. 配置完成后，即可获取在新建可用区所在行获取该可用区域名。

    2. 返回 **终端节点** 页面，在端点所在行中找到端点域名。

    3. 进入 ECS 服务器，使用 `ping` 命令通过端点域名和可用区域名来链接到对应的数仓服务单元。

  
  :::warning 非常重要
  当通过私有链接访问 Relyt 时，阿里云会分配一个位于 10.64.0.0/10 网段的动态 IP 地址。如对应的数仓服务单元开启了网络策略，请确保该网段在网络策略的白名单中。关于网络策略的详细信息，请查看 [网络策略](guides/security/network-policies.md)。
  :::

  </TabItem>
  <TabItem value="腾讯云" label="腾讯云">

    即将上线，敬请期待。

  </TabItem>
</Tabs>


