
# 管理 DPS 集群

当使用服务单元处理数据时，DPS 集群是必不可少的。Relyt 提供了丰富的功能来帮助你管理 DPS 集群以满足你的业务需求。例如，你可以根据特定规格创建多个 DPS 集群来处理不同的工作负载，实现工作负载间的隔离。你也可以启用**自动暂停**、**自动恢复**、**自适应查询扩展**来更好地管理你的云预算。

:::caution 重要
在 Relyt 中，只有由账号扮演的数仓用户拥有 DPS 集群管理权限。
:::

## 创建 DPS 集群

Relyt 支持按需创建多个 Extreme DPS 集群。

:::info
每个数仓服务单元支持创建一个 Hybrid DPS 集群和多个 Extreme DPS 集群。Hybrid DPS 集群在数仓服务单元创建时一同创建。关于如何创建 Hybrid DPS 集群，请参考 [管理数仓服务单元](guides/dw-service-units/manage-dw-service-units.md#创建数仓服务单元) 中的“创建数仓服务单元”。
:::

以下步骤详细说明了如何创建 Extreme DPS 集群。如需创建多个 Extreme DPS 集群，重复以下步骤即可。

1. 登录 Relyt 全局控制台，点击目标数仓服务单元卡片进入服务单元。

2. 在左侧导航栏中，点击 **DPS 集群**。然后点击页面右上角的 **+ DPS 集群**。

3. 在弹出的 **创建 DPS 集群** 页面，配置 DPS 集群。

    下表描述了 DPS 集群的配置参数。

    | 参数 | 是否必填 | 描述 |
    | :- | :- | :- |
    | 名称 | 是 | DPS 集群的名称。该值只能包含字母、数字和连字符 (-)，长度为 4 到 32 个字符，并且必须以字母开头。 |
    | 类别 | 是 | DPS 集群使用的 DPS 类型。固定为 **Extreme DPS**。 |
    | 大小 | 是 | DPS 集群的计算资源大小，单位为 DPU。 |
    | 自动暂停 | 是 | DPS 集群允许最大空闲时长。超过此时长，DPS 集群将会自动暂停，默认值为 1 分钟。如需关闭 **自动暂停** 功能，请将此参数设置为 **从不**。 |
    | 自动恢复 | 否 | 是否开启自动恢复功能。开启后，处于暂停状态的 DPS 集群在收到新的查询请求后，会自动恢复服务。该功能默认启用，如需关闭，请将开关设置为 **关闭**。 |
    | 描述 | 否 | DPS 集群的描述。 |
    | 高级选项 | 否 | DPS 集群的高级选项。目前支持配置**自适应查询扩展**（AQS）特性。关于 AQS 的详细介绍，请参考 [自适应查询扩展](aqs.md)。 |

    <br/>

    :::info 配置建议
    建议开启**自动恢复**功能。关闭此功能后，如有新的查询下发到处于暂停状态中的 DPS 集群，查询将无法执行。
    :::

4. 点击 **创建**。

完成操作后，DPS 集群将出现在 **DPS 集群** 页面的列表中。当其状态变为 **已激活** 时，即可使用。

## 修改 DPS 集群配置

随着业务发展，工作负载的大小可能会改变，当前的 DPS 集群的大小可能不再满足需求。Relyt 支持实时在线调整 DPS 集群的大小，且不会影响运行中的业务。

1. 登录 Relyt 全局控制台，点击目标数仓服务单元卡片进入服务单元。

2. 在左侧导航栏中，点击 **DPS 集群**。

3. 在DPS 集群列表中，找到目标 DPS 集群，然后在 **操作** 列中选择 **...** > **编辑**。

4. 在 **编辑 DPS 集群** 页面，修改对应配置，并点击 **更新**。

    支持修改的配置项包括**大小**、**自动暂停**、**自动恢复**和**描述**。关于各配置项详细说明，请参考 [创建 DPS 集群](#创建-dps-集群) 中的参数说明表格。

配置完成后，新的配置立即生效，无需重启等其他操作。

## 启用自动暂停

自动暂停功能允许你为 DPS 集群设置一个暂停条件。这样，如果满足暂停条件，DPS 集群将自动暂停。在 Relyt 中，自动暂停功能是由你为 DPS 集群设置的最大空闲时间触发的，即在创建 DPS 集群时配置的 **自动暂停** 字段的值。

:::info
自动暂停功能只支持 Extreme DPS 集群，并且只能在创建 Extreme DPS 集群时配置。
:::

要创建启用了自动暂停的 Extreme DPS 集群，请参见 [创建 DPS 集群](#创建-dps-集群) 中提供的过程，将 **自动暂停** 设置为除 **从不** 以外的任何值。

请注意，一旦启用自动暂停，就不能禁用。如果你不再希望 Extreme DPS 集群自动暂停，你可以先删除 Extreme DPS 集群，然后重新创建它，将 **自动暂停** 设置为 **从不**。

## 手动暂停 DPS 集群

除自动暂停外，DPS 集群还支持手动暂停。

:::caution
DPS 集群暂停后，正在运行或排队中的所有查询都将被终止。请谨慎执行此操作。
:::

1. 登录 Relyt 全局控制台，点击目标数仓服务单元卡片进入服务单元。

2. 在左侧导航栏中，点击 **DPS 集群**。

3. 在 **DPS 集群** 页面，找到要暂停的 DPS 集群，在 **操作** 列中选择 **...** > **暂停**。

    请注意，只有活动状态的 DPS 集群才可以被暂停。

4. 在弹出的确认对话框中，点击 **暂停**。

## 删除 DPS 集群

你可以删除不再需要的 Extreme DPS 集群。

:::info
Hybrid DPS 集群不能被删除。
:::

1. 登录 Relyt 全局控制台，点击目标数仓服务单元卡片进入服务单元。

2. 在左侧导航栏中，点击 **DPS 集群**。

3. 在 **DPS 集群** 页面，找到要删除的 Extreme DPS 集群，然后在 **操作** 列中选择 **...** > **删除**。

5. 在弹出的确认对话框中，输入 DPS 集群的名称，然后点击 **删除**。